ace.define("ace/snippets",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/anchor","ace/keyboard/hash_handler","ace/tokenizer","ace/lib/dom","ace/editor"],function(a,b,c){"use strict";var d=a("./lib/oop"),e=a("./lib/event_emitter").EventEmitter,f=a("./lib/lang"),g=a("./range").Range,h=a("./anchor").Anchor,i=a("./keyboard/hash_handler").HashHandler,j=a("./tokenizer").Tokenizer,k=g.comparePoints,l=function(){this.snippetMap={},this.snippetNameMap={}};(function(){d.implement(this,e),this.getTokenizer=function(){function a(a,b,c){return a=a.substr(1),/^\d+$/.test(a)&&!c.inFormatString?[{tabstopId:parseInt(a,10)}]:[{text:a}]}function b(a){return"(?:[^\\\\"+a+"]|\\\\.)"}return l.$tokenizer=new j({start:[{regex:/:/,onMatch:function(a,b,c){return c.length&&c[0].expectIf?(c[0].expectIf=!1,c[0].elseBranch=c[0],[c[0]]):":"}},{regex:/\\./,onMatch:function(a,b,c){var d=a[1];return"}"==d&&c.length?a=d:"`$\\".indexOf(d)!=-1?a=d:c.inFormatString&&("n"==d?a="\n":"t"==d?a="\n":"ulULE".indexOf(d)!=-1&&(a={changeCase:d,local:d>"a"})),[a]}},{regex:/}/,onMatch:function(a,b,c){return[c.length?c.shift():a]}},{regex:/\$(?:\d+|\w+)/,onMatch:a},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(b,c,d){var e=a(b.substr(1),c,d);return d.unshift(e[0]),e},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+b("\\|")+"*\\|",onMatch:function(a,b,c){c[0].choices=a.slice(1,-1).split(",")},next:"start"},{regex:"/("+b("/")+"+)/(?:("+b("/")+"*)/)(\\w*):?",onMatch:function(a,b,c){var d=c[0];return d.fmtString=a,a=this.splitRegex.exec(a),d.guard=a[1],d.fmt=a[2],d.flag=a[3],""},next:"start"},{regex:"`"+b("`")+"*`",onMatch:function(a,b,c){return c[0].code=a.splice(1,-1),""},next:"start"},{regex:"\\?",onMatch:function(a,b,c){c[0]&&(c[0].expectIf=!0)},next:"start"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:"/("+b("/")+"+)/",token:"regex"},{regex:"",onMatch:function(a,b,c){c.inFormatString=!0},next:"start"}]}),l.prototype.getTokenizer=function(){return l.$tokenizer},l.$tokenizer},this.tokenizeTmSnippet=function(a,b){return this.getTokenizer().getLineTokens(a,b).tokens.map(function(a){return a.value||a})},this.$getDefaultValue=function(a,b){if(/^[A-Z]\d+$/.test(b)){var c=b.substr(1);return(this.variables[b[0]+"__"]||{})[c]}if(/^\d+$/.test(b))return(this.variables.__||{})[b];if(b=b.replace(/^TM_/,""),a){var d=a.session;switch(b){case"CURRENT_WORD":var e=d.getWordRange();case"SELECTION":case"SELECTED_TEXT":return d.getTextRange(e);case"CURRENT_LINE":return d.getLine(a.getCursorPosition().row);case"PREV_LINE":return d.getLine(a.getCursorPosition().row-1);case"LINE_INDEX":return a.getCursorPosition().column;case"LINE_NUMBER":return a.getCursorPosition().row+1;case"SOFT_TABS":return d.getUseSoftTabs()?"YES":"NO";case"TAB_SIZE":return d.getTabSize();case"FILENAME":case"FILEPATH":return"";case"FULLNAME":return"Ace"}}},this.variables={},this.getVariableValue=function(a,b){return this.variables.hasOwnProperty(b)?this.variables[b](a,b)||"":this.$getDefaultValue(a,b)||""},this.tmStrFormat=function(a,b,c){var d=b.flag||"",e=b.guard;e=new RegExp(e,d.replace(/[^gi]/,""));var f=this.tokenizeTmSnippet(b.fmt,"formatString"),g=this,h=a.replace(e,function(){g.variables.__=arguments;for(var a=g.resolveVariables(f,c),b="E",d=0;d<a.length;d++){var e=a[d];if("object"==typeof e)if(a[d]="",e.changeCase&&e.local){var h=a[d+1];h&&"string"==typeof h&&("u"==e.changeCase?a[d]=h[0].toUpperCase():a[d]=h[0].toLowerCase(),a[d+1]=h.substr(1))}else e.changeCase&&(b=e.changeCase);else"U"==b?a[d]=e.toUpperCase():"L"==b&&(a[d]=e.toLowerCase())}return a.join("")});return this.variables.__=null,h},this.resolveVariables=function(a,b){function g(b){var c=a.indexOf(b,d+1);c!=-1&&(d=c)}for(var c=[],d=0;d<a.length;d++){var e=a[d];if("string"==typeof e)c.push(e);else{if("object"!=typeof e)continue;if(e.skip)g(e);else{if(e.processed<d)continue;if(e.text){var f=this.getVariableValue(b,e.text);f&&e.fmtString&&(f=this.tmStrFormat(f,e)),e.processed=d,null==e.expectIf?f&&(c.push(f),g(e)):f?e.skip=e.elseBranch:g(e)}else null!=e.tabstopId?c.push(e):null!=e.changeCase&&c.push(e)}}}return c},this.insertSnippetForSelection=function(a,b){function j(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if("object"==typeof d){if(i[d.tabstopId])continue;var e=a.lastIndexOf(d,c-1);d=b[e]||{tabstopId:d.tabstopId}}b[c]=d}return b}var c=a.getCursorPosition(),d=a.session.getLine(c.row),e=a.session.getTabString(),f=d.match(/^\s*/)[0];c.column<f.length&&(f=f.slice(0,c.column));var g=this.tokenizeTmSnippet(b);g=this.resolveVariables(g,a),g=g.map(function(a){return"\n"==a?a+f:"string"==typeof a?a.replace(/\t/g,e):a});var h=[];g.forEach(function(a,b){if("object"==typeof a){var c=a.tabstopId,d=h[c];if(d||(d=h[c]=[],d.index=c,d.value=""),d.indexOf(a)===-1){d.push(a);var e=g.indexOf(a,b+1);if(e!==-1){var f=g.slice(b+1,e),i=f.some(function(a){return"object"==typeof a});i&&!d.value?d.value=f:!f.length||d.value&&"string"==typeof d.value||(d.value=f.join(""))}}}}),h.forEach(function(a){a.length=0});for(var i={},k=0;k<g.length;k++){var l=g[k];if("object"==typeof l){var n=l.tabstopId,o=g.indexOf(l,k+1);if(i[n])i[n]===l&&(i[n]=null);else{var p=h[n],q="string"==typeof p.value?[p.value]:j(p.value);q.unshift(k+1,Math.max(0,o-k)),q.push(l),i[n]=l,g.splice.apply(g,q),p.indexOf(l)===-1&&p.push(l)}}}var r=0,s=0,t="";g.forEach(function(a){"string"==typeof a?("\n"===a[0]?(s=a.length-1,r++):s+=a.length,t+=a):a.start?a.end={row:r,column:s}:a.start={row:r,column:s}});var u=a.getSelectionRange(),v=a.session.replace(u,t),w=new m(a),x=a.inVirtualSelectionMode&&a.selection.index;w.addTabstops(h,u.start,v,x)},this.insertSnippet=function(a,b){var c=this;return a.inVirtualSelectionMode?c.insertSnippetForSelection(a,b):(a.forEachSelection(function(){c.insertSnippetForSelection(a,b)},null,{keepOrder:!0}),void(a.tabstopManager&&a.tabstopManager.tabNext()))},this.$getScope=function(a){var b=a.session.$mode.$id||"";if(b=b.split("/").pop(),"html"===b||"php"===b){"php"!==b||a.session.$mode.inlinePhp||(b="html");var c=a.getCursorPosition(),d=a.session.getState(c.row);"object"==typeof d&&(d=d[0]),d.substring&&("js-"==d.substring(0,3)?b="javascript":"css-"==d.substring(0,4)?b="css":"php-"==d.substring(0,4)&&(b="php"))}return b},this.getActiveScopes=function(a){var b=this.$getScope(a),c=[b],d=this.snippetMap;return d[b]&&d[b].includeScopes&&c.push.apply(c,d[b].includeScopes),c.push("_"),c},this.expandWithTab=function(a,b){var c=this,d=a.forEachSelection(function(){return c.expandSnippetForSelection(a,b)},null,{keepOrder:!0});return d&&a.tabstopManager&&a.tabstopManager.tabNext(),d},this.expandSnippetForSelection=function(a,b){var h,c=a.getCursorPosition(),d=a.session.getLine(c.row),e=d.substring(0,c.column),f=d.substr(c.column),g=this.snippetMap;return this.getActiveScopes(a).some(function(a){var b=g[a];return b&&(h=this.findMatchingSnippet(b,e,f)),!!h},this),!!h&&(!(!b||!b.dryRun)||(a.session.doc.removeInLine(c.row,c.column-h.replaceBefore.length,c.column+h.replaceAfter.length),this.variables.M__=h.matchBefore,this.variables.T__=h.matchAfter,this.insertSnippetForSelection(a,h.content),this.variables.M__=this.variables.T__=null,!0))},this.findMatchingSnippet=function(a,b,c){for(var d=a.length;d--;){var e=a[d];if((!e.startRe||e.startRe.test(b))&&(!e.endRe||e.endRe.test(c))&&(e.startRe||e.endRe))return e.matchBefore=e.startRe?e.startRe.exec(b):[""],e.matchAfter=e.endRe?e.endRe.exec(c):[""],e.replaceBefore=e.triggerRe?e.triggerRe.exec(b)[0]:"",e.replaceAfter=e.endTriggerRe?e.endTriggerRe.exec(c)[0]:"",e}},this.snippetMap={},this.snippetNameMap={},this.register=function(a,b){function g(a){return a&&!/^\^?\(.*\)\$?$|^\\b$/.test(a)&&(a="(?:"+a+")"),a||""}function h(a,b,c){return a=g(a),b=g(b),c?(a=b+a,a&&"$"!=a[a.length-1]&&(a+="$")):(a+=b,a&&"^"!=a[0]&&(a="^"+a)),new RegExp(a)}function i(a){a.scope||(a.scope=b||"_"),b=a.scope,c[b]||(c[b]=[],d[b]={});var g=d[b];if(a.name){var i=g[a.name];i&&e.unregister(i),g[a.name]=a}c[b].push(a),a.tabTrigger&&!a.trigger&&(!a.guard&&/^\w/.test(a.tabTrigger)&&(a.guard="\\b"),a.trigger=f.escapeRegExp(a.tabTrigger)),a.startRe=h(a.trigger,a.guard,!0),a.triggerRe=new RegExp(a.trigger,"",!0),a.endRe=h(a.endTrigger,a.endGuard,!0),a.endTriggerRe=new RegExp(a.endTrigger,"",!0)}var c=this.snippetMap,d=this.snippetNameMap,e=this;a||(a=[]),a&&a.content?i(a):Array.isArray(a)&&a.forEach(i),this._signal("registerSnippets",{scope:b})},this.unregister=function(a,b){function e(a){var e=d[a.scope||b];if(e&&e[a.name]){delete e[a.name];var f=c[a.scope||b],g=f&&f.indexOf(a);g>=0&&f.splice(g,1)}}var c=this.snippetMap,d=this.snippetNameMap;a.content?e(a):Array.isArray(a)&&a.forEach(e)},this.parseSnippetFile=function(a){a=a.replace(/\r/g,"");for(var e,b=[],c={},d=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;e=d.exec(a);){if(e[1])try{c=JSON.parse(e[1]),b.push(c)}catch(a){}if(e[4])c.content=e[4].replace(/^\t/gm,""),b.push(c),c={};else{var f=e[2],g=e[3];if("regex"==f){var h=/\/((?:[^\/\\]|\\.)*)|$/g;c.guard=h.exec(g)[1],c.trigger=h.exec(g)[1],c.endTrigger=h.exec(g)[1],c.endGuard=h.exec(g)[1]}else"snippet"==f?(c.tabTrigger=g.match(/^\S*/)[0],c.name||(c.name=g)):c[f]=g}}return b},this.getSnippetByName=function(a,b){var d,c=this.snippetNameMap;return this.getActiveScopes(b).some(function(b){var e=c[b];return e&&(d=e[a]),!!d},this),d}}).call(l.prototype);var m=function(a){return a.tabstopManager?a.tabstopManager:(a.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=f.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),void this.attach(a))};(function(){this.attach=function(a){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=a,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(a){var b=a.data.range,c="r"==a.data.action[0],d=b.start,e=b.end,f=d.row,g=e.row,h=g-f,i=e.column-d.column;if(c&&(h=-h,i=-i),!this.$inChange&&c){var j=this.selectedTabstop,l=j&&!j.some(function(a){return k(a.start,d)<=0&&k(a.end,e)>=0});if(l)return this.detach()}for(var m=this.ranges,n=0;n<m.length;n++){var o=m[n];o.end.row<d.row||(c&&k(d,o.start)<0&&k(e,o.end)>0?(this.removeRange(o),n--):(o.start.row==f&&o.start.column>d.column&&(o.start.column+=i),o.end.row==f&&o.end.column>=d.column&&(o.end.column+=i),o.start.row>=f&&(o.start.row+=h),o.end.row>=f&&(o.end.row+=h),k(o.start,o.end)>0&&this.removeRange(o)))}m.length||this.detach()},this.updateLinkedFields=function(){var a=this.selectedTabstop;if(a&&a.hasLinkedRanges){this.$inChange=!0;for(var c=this.editor.session,d=c.getTextRange(a.firstNonLinked),e=a.length;e--;){var f=a[e];if(f.linked){var g=b.snippetManager.tmStrFormat(d,f.original);c.replace(f,g)}}this.$inChange=!1}},this.onAfterExec=function(a){a.command&&!a.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(this.editor){for(var a=this.editor.selection.lead,b=this.editor.selection.anchor,c=this.editor.selection.isEmpty(),d=this.ranges.length;d--;)if(!this.ranges[d].linked){var e=this.ranges[d].contains(a.row,a.column),f=c||this.ranges[d].contains(b.row,b.column);if(e&&f)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(a){var b=this.tabstops.length,c=this.index+(a||1);c=Math.min(Math.max(c,1),b),c==b&&(c=0),this.selectTabstop(c),0===c&&this.detach()},this.selectTabstop=function(a){this.$openTabstops=null;var b=this.tabstops[this.index];if(b&&this.addTabstopMarkers(b),this.index=a,b=this.tabstops[this.index],b&&b.length){if(this.selectedTabstop=b,this.editor.inVirtualSelectionMode)this.editor.selection.setRange(b.firstNonLinked);else{var c=this.editor.multiSelect;c.toSingleRange(b.firstNonLinked.clone());for(var d=b.length;d--;)b.hasLinkedRanges&&b[d].linked||c.addRange(b[d].clone(),!0);c.ranges[0]&&c.addRange(c.ranges[0].clone())}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)}},this.addTabstops=function(a,b,c){if(this.$openTabstops||(this.$openTabstops=[]),!a[0]){var d=g.fromPoints(c,c);p(d.start,b),p(d.end,b),a[0]=[d],a[0].index=0}var e=this.index,f=[e+1,0],h=this.ranges;a.forEach(function(a,c){for(var d=this.$openTabstops[c]||a,e=a.length;e--;){var i=a[e],j=g.fromPoints(i.start,i.end||i.start);o(j.start,b),o(j.end,b),j.original=i,j.tabstop=d,h.push(j),d!=a?d.unshift(j):d[e]=j,i.fmtString?(j.linked=!0,d.hasLinkedRanges=!0):d.firstNonLinked||(d.firstNonLinked=j)}d.firstNonLinked||(d.hasLinkedRanges=!1),d===a&&(f.push(d),this.$openTabstops[c]=d),this.addTabstopMarkers(d)},this),f.length>2&&(this.tabstops.length&&f.push(f.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,f))},this.addTabstopMarkers=function(a){var b=this.editor.session;a.forEach(function(a){a.markerId||(a.markerId=b.addMarker(a,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(a){var b=this.editor.session;a.forEach(function(a){b.removeMarker(a.markerId),a.markerId=null})},this.removeRange=function(a){var b=a.tabstop.indexOf(a);a.tabstop.splice(b,1),b=this.ranges.indexOf(a),this.ranges.splice(b,1),this.editor.session.removeMarker(a.markerId),a.tabstop.length||(b=this.tabstops.indexOf(a.tabstop),b!=-1&&this.tabstops.splice(b,1),this.tabstops.length||this.detach())},this.keyboardHandler=new i,this.keyboardHandler.bindKeys({Tab:function(a){b.snippetManager&&b.snippetManager.expandWithTab(a)||a.tabstopManager.tabNext(1)},"Shift-Tab":function(a){a.tabstopManager.tabNext(-1)},Esc:function(a){a.tabstopManager.detach()},Return:function(a){return!1}})}).call(m.prototype);var n={};n.onChange=h.prototype.onChange,n.setPosition=function(a,b){this.pos.row=a,this.pos.column=b},n.update=function(a,b,c){this.$insertRight=c,this.pos=a,this.onChange(b)};var o=function(a,b){0==a.row&&(a.column+=b.column),a.row+=b.row},p=function(a,b){a.row==b.row&&(a.column-=b.column),a.row-=b.row};a("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),b.snippetManager=new l;var q=a("./editor").Editor;(function(){this.insertSnippet=function(a,c){return b.snippetManager.insertSnippet(this,a,c)},this.expandSnippet=function(a){return b.snippetManager.expandWithTab(this,a)}}).call(q.prototype)}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(a,b,c){function f(a,b){var c=a.getTextRange(d.fromPoints({row:0,column:0},b));return c.split(e).length-1}function g(a,b){var c=f(a,b),d=a.getValue().split(e),g=Object.create(null),h=d[c];return d.forEach(function(a,b){if(a&&a!==h){var e=Math.abs(c-b),f=d.length-e;g[a]?g[a]=Math.max(f,g[a]):g[a]=f}}),g}var d=a("../range").Range,e=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;b.getCompletions=function(a,b,c,d,e){var f=g(b,c,d),h=Object.keys(f);e(null,h.map(function(a){return{caption:a,value:a,score:f[a],meta:"local"}}))}}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/edit_session","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom"],function(a,b,c){"use strict";var e=(a("../edit_session").EditSession,a("../virtual_renderer").VirtualRenderer),f=a("../editor").Editor,g=a("../range").Range,h=a("../lib/event"),i=a("../lib/lang"),j=a("../lib/dom"),k=function(a){var b=new e(a);b.$maxLines=4;var c=new f(b);return c.setHighlightActiveLine(!1),c.setShowPrintMargin(!1),c.renderer.setShowGutter(!1),c.renderer.setHighlightGutterLine(!1),c.$mouseHandler.$focusWaitTimout=0,c.$highlightTagPending=!0,c},l=function(a){var b=j.createElement("div"),c=new k(b);a&&a.appendChild(b),b.style.display="none",c.renderer.content.style.cursor="default",c.renderer.setStyle("ace_autocomplete"),c.setOption("displayIndentGuides",!1),c.setOption("dragDelay",150);var d=function(){};c.focus=d,c.$isFocused=!0,c.renderer.$cursorLayer.restartTimer=d,c.renderer.$cursorLayer.element.style.opacity=0,c.renderer.$maxLines=8,c.renderer.$keepTextAreaAtCursor=!1,c.setHighlightActiveLine(!1),c.session.highlight(""),c.session.$searchHighlight.clazz="ace_highlight-marker",c.on("mousedown",function(a){var b=a.getDocumentPosition();c.selection.moveToPosition(b),l.start.row=l.end.row=b.row,a.stop()});var e,f=new g(-1,0,-1,1/0),l=new g(-1,0,-1,1/0);l.id=c.session.addMarker(l,"ace_active-line","fullLine"),c.setSelectOnHover=function(a){a?f.id&&(c.session.removeMarker(f.id),f.id=null):f.id=c.session.addMarker(f,"ace_line-hover","fullLine")},c.setSelectOnHover(!1),c.on("mousemove",function(a){if(!e)return void(e=a);if(e.x!=a.x||e.y!=a.y){e=a,e.scrollTop=c.renderer.scrollTop;var b=e.getDocumentPosition().row;f.start.row!=b&&(f.id||c.setRow(b),n(b))}}),c.renderer.on("beforeRender",function(){if(e&&f.start.row!=-1){e.$pos=null;var a=e.getDocumentPosition().row;f.id||c.setRow(a),n(a,!0)}}),c.renderer.on("afterRender",function(){var a=c.getRow(),b=c.renderer.$textLayer,d=b.element.childNodes[a-b.config.firstRow];d!=b.selectedNode&&(b.selectedNode&&j.removeCssClass(b.selectedNode,"ace_selected"),b.selectedNode=d,d&&j.addCssClass(d,"ace_selected"))});var m=function(){n(-1)},n=function(a,b){a!==f.start.row&&(f.start.row=f.end.row=a,b||c.session._emit("changeBackMarker"),c._emit("changeHoverMarker"))};c.getHoveredRow=function(){return f.start.row},h.addListener(c.container,"mouseout",m),c.on("hide",m),c.on("changeSelection",m),c.session.doc.getLength=function(){return c.data.length},c.session.doc.getLine=function(a){var b=c.data[a];return"string"==typeof b?b:b&&b.value||""};var o=c.session.bgTokenizer;return o.$tokenizeRow=function(a){var b=c.data[a],d=[];if(!b)return d;"string"==typeof b&&(b={value:b}),b.caption||(b.caption=b.value||b.name);var f,g,e=-1;b.iconClass&&d.push({type:b.iconClass,value:" "});for(var h=0;h<b.caption.length;h++)g=b.caption[h],f=b.matchMask&1<<h?1:0,e!==f?(d.push({type:b.className||""+(f?"completion-highlight":""),value:g}),e=f):d[d.length-1].value+=g;if(b.meta){var i=c.renderer.$size.scrollerWidth/c.renderer.layerConfig.characterWidth,j=b.meta;j.length+b.caption.length>i-2&&(j=j.substr(0,i-b.caption.length-3)+"…"),d.push({type:"rightAlignedText",value:j})}return d},o.$updateOnChange=d,o.start=d,c.session.$computeWidth=function(){return this.screenWidth=0},c.$blockScrolling=1/0,c.isOpen=!1,c.isTopdown=!1,c.data=[],c.setData=function(a){c.data=a||[],c.setValue(i.stringRepeat("\n",a.length),-1),c.setRow(0)},c.getData=function(a){return c.data[a]},c.getRow=function(){return l.start.row},c.setRow=function(a){a=Math.max(-1,Math.min(this.data.length,a)),l.start.row!=a&&(c.selection.clearSelection(),l.start.row=l.end.row=a||0,c.session._emit("changeBackMarker"),c.moveCursorTo(a||0,0),c.isOpen&&c._signal("select"))},c.on("changeSelection",function(){c.isOpen&&c.setRow(c.selection.lead.row),c.renderer.scrollCursorIntoView()}),c.hide=function(){this.container.style.display="none",this._signal("hide"),c.isOpen=!1},c.show=function(a,b,d){var f=this.container,g=window.innerHeight,h=window.innerWidth,i=this.renderer,j=i.$maxLines*b*1.4,k=a.top+this.$borderSize;k+j>g-b&&!d?(f.style.top="",f.style.bottom=g-k+"px",c.isTopdown=!1):(k+=b,f.style.top=k+"px",f.style.bottom="",c.isTopdown=!0),f.style.display="",this.renderer.$textLayer.checkForSizeChanges();var l=a.left;l+f.offsetWidth>h&&(l=h-f.offsetWidth),f.style.left=l+"px",this._signal("show"),e=null,c.isOpen=!0},c.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},c.$imageSize=0,c.$borderSize=1,c};j.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}"),b.AcePopup=l}),ace.define("ace/autocomplete/util",["require","exports","module"],function(a,b,c){"use strict";b.parForEach=function(a,b,c){var d=0,e=a.length;0===e&&c();for(var f=0;f<e;f++)b(a[f],function(a,b){d++,d===e&&c(a,b)})};var d=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;b.retrievePrecedingIdentifier=function(a,b,c){c=c||d;for(var e=[],f=b-1;f>=0&&c.test(a[f]);f--)e.push(a[f]);return e.reverse().join("")},b.retrieveFollowingIdentifier=function(a,b,c){c=c||d;for(var e=[],f=b;f<a.length&&c.test(a[f]);f++)e.push(a[f]);return e}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/snippets"],function(a,b,c){"use strict";var d=a("./keyboard/hash_handler").HashHandler,e=a("./autocomplete/popup").AcePopup,f=a("./autocomplete/util"),h=(a("./lib/event"),a("./lib/lang")),i=a("./lib/dom"),j=a("./snippets").snippetManager,k=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new d,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=h.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=h.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new e(document.body||document.documentElement),this.popup.on("click",function(a){this.insertMatch(),a.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(a,b,c){this.popup||this.$init(),this.popup.setData(this.completions.filtered),a.keyBinding.addKeyboardHandler(this.keyboardHandler);var d=a.renderer;if(this.popup.setRow(this.autoSelect?0:-1),c)c&&!b&&this.detach();else{this.popup.setTheme(a.getTheme()),this.popup.setFontSize(a.getFontSize());var e=d.layerConfig.lineHeight,f=d.$cursorLayer.getPixelPosition(this.base,!0);f.left-=this.popup.getTextLeftOffset();var g=a.container.getBoundingClientRect();f.top+=g.top-d.layerConfig.offset,f.left+=g.left-a.renderer.scrollLeft,f.left+=d.$gutterLayer.gutterWidth,this.popup.show(f,e)}},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(a){var b=this.editor.selection.lead;(b.row!=this.base.row||b.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(a){var b=document.activeElement,c=this.editor.textInput.getElement();b==c||this.popup&&b.parentNode==this.popup.container||b==this.tooltipNode||a.relatedTarget==this.tooltipNode||a.relatedTarget==c||this.detach()},this.mousedownListener=function(a){this.detach()},this.mousewheelListener=function(a){this.detach()},this.goTo=function(a){var b=this.popup.getRow(),c=this.popup.session.getLength()-1;switch(a){case"up":b=b<=0?c:b-1;break;case"down":b=b>=c?-1:b+1;break;case"start":b=0;break;case"end":b=c}this.popup.setRow(b)},this.insertMatch=function(a){if(a||(a=this.popup.getData(this.popup.getRow())),!a)return!1;if(a.completer&&a.completer.insertMatch)a.completer.insertMatch(this.editor,a);else{if(this.completions.filterText)for(var d,b=this.editor.selection.getAllRanges(),c=0;d=b[c];c++)d.start.column-=this.completions.filterText.length,this.editor.session.remove(d);a.snippet?j.insertSnippet(this.editor,a.snippet):this.editor.execCommand("insertstring",a.value||a)}this.detach()},this.commands={Up:function(a){a.completer.goTo("up")},Down:function(a){a.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(a){a.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(a){a.completer.goTo("end")},Esc:function(a){a.completer.detach()},Return:function(a){return a.completer.insertMatch()},"Shift-Return":function(a){a.completer.insertMatch(!0)},Tab:function(a){var b=a.completer.insertMatch();return b||a.tabstopManager?b:void a.completer.goTo("down")},PageUp:function(a){a.completer.popup.gotoPageUp()},PageDown:function(a){a.completer.popup.gotoPageDown()}},this.gatherCompletions=function(a,b){var c=a.getSession(),d=a.getCursorPosition(),e=c.getLine(d.row),g=f.retrievePrecedingIdentifier(e,d.column);this.base=c.doc.createAnchor(d.row,d.column-g.length),this.base.$insertRight=!0;var h=[],i=a.completers.length;return a.completers.forEach(function(e,j){e.getCompletions(a,c,d,g,function(d,e){d||(h=h.concat(e));var g=a.getCursorPosition(),j=c.getLine(g.row);b(null,{prefix:f.retrievePrecedingIdentifier(j,g.column,e[0]&&e[0].identifierRegex),matches:h,finished:0===--i})})}),!0},this.showPopup=function(a){this.editor&&this.detach(),this.activated=!0,this.editor=a,a.completer!=this&&(a.completer&&a.completer.detach(),a.completer=this),a.on("changeSelection",this.changeListener),a.on("blur",this.blurListener),a.on("mousedown",this.mousedownListener),a.on("mousewheel",this.mousewheelListener),this.updateCompletions()},this.updateCompletions=function(a){if(a&&this.base&&this.completions){var b=this.editor.getCursorPosition(),c=this.editor.session.getTextRange({start:this.base,end:b});if(c==this.completions.filterText)return;return this.completions.setFilter(c),this.completions.filtered.length&&(1!=this.completions.filtered.length||this.completions.filtered[0].value!=c||this.completions.filtered[0].snippet)?void this.openPopup(this.editor,c,a):this.detach()}var d=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(b,c){var e=function(a){if(this.popup&&this.popup.setData(a),c.finished)return this.detach()}.bind(this),f=c.prefix,g=c&&c.matches;if(!g||!g.length)return e(g);if(0===f.indexOf(c.prefix)&&d==this.gatherCompletionsId){this.completions=new l(g),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(f);var h=this.completions.filtered;return h.length&&(1!=h.length||h[0].value!=f||h[0].snippet)?this.autoInsert&&1==h.length&&c.finished?this.insertMatch(h[0]):void this.openPopup(this.editor,f,a):e(h)}}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var a=this.popup,b=a.data,c=b&&(b[a.getHoveredRow()]||b[a.getRow()]),d=null;return c&&this.editor&&this.popup.isOpen?(this.editor.completers.some(function(a){return a.getDocTooltip&&(d=a.getDocTooltip(c)),d}),d||(d=c),"string"==typeof d&&(d={docText:d}),d&&(d.docHTML||d.docText)?void this.showDocTooltip(d):this.hideDocTooltip()):this.hideDocTooltip()},this.showDocTooltip=function(a){this.tooltipNode||(this.tooltipNode=i.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this));var b=this.tooltipNode;a.docHTML?b.innerHTML=a.docHTML:a.docText&&(b.textContent=a.docText),b.parentNode||document.body.appendChild(b);var c=this.popup,d=c.container.getBoundingClientRect();b.style.top=c.container.style.top,b.style.bottom=c.container.style.bottom,window.innerWidth-d.right<320?(b.style.right=window.innerWidth-d.left+"px",b.style.left=""):(b.style.left=d.right+1+"px",b.style.right=""),b.style.display="block"},this.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var a=this.tooltipNode;this.editor.isFocused()||document.activeElement!=a||this.editor.focus(),this.tooltipNode=null,a.parentNode&&a.parentNode.removeChild(a)}}}).call(k.prototype),k.startCommand={name:"startAutocomplete",exec:function(a){a.completer||(a.completer=new k),a.completer.autoInsert=!1,a.completer.autoSelect=!0,a.completer.showPopup(a),a.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var l=function(a,b,c){this.all=a,this.filtered=a,this.filterText=b||"",this.exactMatch=!1};(function(){this.setFilter=function(a){if(a.length>this.filterText&&0===a.lastIndexOf(this.filterText,0))var b=this.filtered;else var b=this.all;this.filterText=a,b=this.filterCompletions(b,this.filterText),b=b.sort(function(a,b){return b.exactMatch-a.exactMatch||b.score-a.score});var c=null;b=b.filter(function(a){var b=a.snippet||a.caption||a.value;return b!==c&&(c=b,!0)}),this.filtered=b},this.filterCompletions=function(a,b){var c=[],d=b.toUpperCase(),e=b.toLowerCase();a:for(var g,f=0;g=a[f];f++){var h=g.value||g.caption||g.snippet;if(h){var l,m,i=-1,j=0,k=0;if(this.exactMatch){if(b!==h.substr(0,b.length))continue a}else for(var n=0;n<b.length;n++){var o=h.indexOf(e[n],i+1),p=h.indexOf(d[n],i+1);if(l=o>=0&&(p<0||o<p)?o:p,l<0)continue a;m=l-i-1,m>0&&(i===-1&&(k+=10),k+=m),j|=1<<l,i=l}g.matchMask=j,g.exactMatch=k?0:1,g.score=(g.score||0)-k,c.push(g)}}return c}}).call(l.prototype),b.Autocomplete=k,b.FilteredList=l}),ace.define("ace/tern/tern_server",["require","exports","module","ace/range","ace/lib/dom"],function(require,exports,module){"use strict";function resolveFilePath(a,b,c){a.options.resolveFilePath?a.options.resolveFilePath(b,c):c(b)}function getFile(a,b,c){var d=a.docs[b];d?c(docValue(a,d)):a.options.getFile?a.options.getFile(b,c):c(null)}function findDoc(a,b,c){for(var d in a.docs){var e=a.docs[d];if(e.doc==b)return e}if(!c)for(var f=0;;++f)if(d="[doc"+(f||"")+"]",!a.docs[d]){c=d;break}return a.addDoc(c,b)}function toTernLoc(a){return"undefined"!=typeof a.row?{line:a.row,ch:a.column}:a}function toAceLoc(a){return a.line?{row:a.line,column:a.ch}:a}function buildRequest(a,b,c,d,e){var f=[],g=0,h=!c.fullDocs;if(h||delete c.fullDocs,"string"==typeof c&&(c={type:c}),c.lineCharPositions=!0,null==c.end){var i=b.doc.getSelectionRange();c.end=toTernLoc(d||i.end),i.start!=i.end&&(c.start=toTernLoc(i.start))}var j=c.start||c.end;if(b.changed)if(!e&&b.doc.session.getLength()>bigDoc&&h!==!1&&b.changed.to-b.changed.from<100&&b.changed.from<=j.line&&b.changed.to>c.end.line){f.push(getFragmentAround(b,j,c.end)),c.file="#0";var g=f[0].offsetLines;null!=c.start&&(c.start=Pos(c.start.line- -g,c.start.ch)),c.end=Pos(c.end.line-g,c.end.ch);
}else f.push({type:"full",name:b.name,text:docValue(a,b)}),c.file=b.name,b.changed=null;else c.file=b.name;for(var k in a.docs){var l=a.docs[k];l.changed&&l!=b&&(f.push({type:"full",name:l.name,text:docValue(a,l)}),l.changed=null)}return{query:c,files:f,timeout:a.queryTimeout}}function getFragmentAround(a,b,c){for(var g,d=a.doc,e=null,f=null,h=d.session.$tabSize,i=b.line-1,j=Math.max(0,i-50);i>=j;--i){var k=d.session.getLine(i),l=k.search(/\bfunction\b/);if(!(l<0)){var m=countColumn(k,null,h);null!=e&&e<=m||(e=m,f=i)}}null==f&&(f=j);var n=Math.min(d.session.getLength()-1,c.line+20);if(null==e||e==countColumn(d.session.getLine(b.line),null,h))g=n;else for(g=c.line+1;g<n;++g){var m=countColumn(d.session.getLine(g),null,h);if(m<=e)break}var o=Pos(f,0);return{type:"part",name:a.name,offsetLines:o.line,text:d.session.getTextRange({start:toAceLoc(o),end:toAceLoc(Pos(g,0))})}}function countColumn(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),b==-1&&(b=a.length));for(var f=d||0,g=e||0;f<b;++f)"\t"==a.charAt(f)?g+=c-g%c:++g;return g}function docValue(a,b){var c=b.doc.getValue();return a.options.fileFilter&&(c=a.options.fileFilter(c,b.name,b.doc)),c}function typeToIcon(a){var b;return b="?"==a?"unknown":"number"==a||"string"==a||"bool"==a?a:/^fn\(/.test(a)?"fn":/^\[/.test(a)?"array":"object",cls+"completion "+cls+"completion-"+b}function getCompletions(a,b,c,d,e,f){var g=function(){try{var b=a.lastAutoCompleteFireTime;if(!b)return!1;var c=(new Date).getTime()-b;if(c<1e3)return!0}catch(a){showError({msg:"autoCompleteFiredTwiceInThreshold",err:a})}return!1},h=g();if(!h){var i=getCurrentToken(b);i&&i.type&&i.type.indexOf("comment")!==-1&&(h=!0)}var j="";debugCompletions&&(j=Math.random().toString(36).slice(2),console.group(j),console.time("get completions from tern server")),a.request(b,{type:"completions",types:!0,origins:!0,docs:!0,filter:!1,omitObjectPrototype:!1,sort:!1,includeKeywords:!0,guess:!0,expandWordForward:!0},function(g,i){function t(){return!popupSelectBound&&(b.completer.popup?(b.completer.popup.on("select",u),b.completer.popup.on("hide",function(){closeAllTips()}),setTimeout(u,10),void(popupSelectBound=!0)):void setTimeout(t,100))}function u(){closeAllTips();var a=b.completer.popup.getData(b.completer.popup.getRow());if(a&&a.doc){var c=b.completer.popup.renderer.getContainerElement();s=makeTooltip(c.getBoundingClientRect().right+window.pageXOffset,c.getBoundingClientRect().top+window.pageYOffset,createInfoDataTip(a,!0),b),s.className+=" "+cls+"hint-doc"}}if(debugCompletions&&console.timeEnd("get completions from tern server"),g)return showError(a,b,g);var k=i.completions.map(function(a){return{iconClass:" "+(a.guess?cls+"guess":typeToIcon(a.type)),doc:a.doc,type:a.type,caption:a.name,value:a.name,score:99999,meta:a.origin?a.origin.replace(/^.*[\\\/]/,""):"tern"}});debugCompletions&&console.time("get and merge other completions");var l=[];if(b.getOption("enableBasicAutocompletion")===!0)try{l=b.session.$mode.getCompletions()}catch(a){}if((h||0===k.length)&&a.aceTextCompletor){debugCompletions&&console.time("aceTextCompletor");var m=[];try{a.aceTextCompletor.getCompletions(b,c,d,e,function(a,b){for(var c=function(a,b){if(a=a.toLowerCase().trim(),a.length<2)return!0;for(var c=!1,d=0;d<l.length;d++)if(l[d].value.toString().toLowerCase()==a){c=!0;break}return c},d=0;d<m.length;d++){var e=m[d];c(e.value)||l.push(e)}})}catch(c){showError(a,b,{msg:"ace text completor error",err:c})}debugCompletions&&console.timeEnd("aceTextCompletor")}if(l.length>0){for(var n=k.slice(),o=0;o<l.length;o++){for(var p=l[o],q=!1,r=0;r<k.length;r++)if(k[r].value.toString()===p.value.toString()){q=!0;break}q||n.push(p)}k=n.slice()}debugCompletions&&console.timeEnd("get and merge other completions"),f(null,k),debugCompletions&&console.groupEnd(j);var s=null;t()||setTimeout(u,10);try{a.lastAutoCompleteFireTime=(new Date).getTime()}catch(c){showError(a,b,{msg:"error with last autoCompleteFireTime ",err:c})}})}function showType(a,b,c,d){if(d){if(b.completer&&b.completer.popup&&b.completer.popup.isOpen)return;if(!isOnFunctionCall(b))return}else if(!inJavascriptMode(b))return;var e=function(f,g,h){var i="";if(f){if(d)return;return showError(a,b,f)}if(a.options.typeTip)i=a.options.typeTip(g);else{if(d){if(g.hasOwnProperty("guess")&&g.guess===!0)return;if("?"==g.type||"string"==g.type||"number"==g.type||"bool"==g.type||"date"==g.type||"fn(document: ?)"==g.type||"fn()"==g.type)return}if(g.hasOwnProperty("type")){if("?"==g.type)return void(i=tempTooltip(b,elFromString("<span>?</span>"),1e3));if(g.type.toString().length>1&&"fn"!==g.type.toString().substr(0,2)){var j=function(a,b){e(a,b,g)};return void a.request(b,"definition",j,c,!1,null)}}else h&&h.hasOwnProperty("type")&&(g.type=h.type,g.name=h.name,g.exprName=h.exprName)}i=createInfoDataTip(g,!0),setTimeout(function(){var a=getCusorPosForTooltip(b);makeTooltip(a.left,a.top,i,b,!0)},10)};a.request(b,"type",e,c,!d)}function createInfoDataTip(a,b,c){var d=elt("span",null),e=a.doc,f=a.params||parseJsDocParams(e);if(b){var g=a.fnArgs?a.fnArgs:a.type?parseFnType(a.type):null;if(g){var h=function(a,b){if(null===f)return null;if(!a.name)return null;for(var c=[],d=0;d<f.length;d++)if(b===!0)f[d].parentName.toLowerCase().trim()===a.name.toLowerCase().trim()&&c.push(f[d]);else if(f[d].name.toLowerCase().trim()===a.name.toLowerCase().trim())return f[d];return b===!0?c:null},i=function(a){var b=a.name;return a.optional===!0&&(b=a.defaultValue?"["+b+"="+a.defaultValue+"]":"["+b+"]"),b},j=0===f.length||!isNaN(parseInt(c)),k="";k+=htmlEncode(a.exprName||a.name||"fn"),k+="(";for(var l=null,m=[],n=0;n<g.args.length;n++){var o="",p=!isNaN(parseInt(c))&&n===c,q=g.args[n],r=q.name||"?";if(r.length>1&&"?"===r.substr(r.length-1)&&(r=r.substr(0,r.length-1),q.name=r),j){var s=h(q,!1),t=h(q,!0),u=q.type,v=!1,w="";if(null!==s&&(r=s.name,s.type&&(u=s.type),p&&(l=s),v=s.optional,w=s.defaultValue.trim()),t&&t.length>0){p&&(m=t),u="{";for(var x=0;x<t.length;x++)u+=t[x].name,x+1!==t.length&&t.length>1&&(u+=", ");u+="}"}o+=u?'<span class="'+cls+'type">'+htmlEncode(u)+"</span> ":"",o+='<span class="'+cls+(p?"farg-current":"farg")+'">'+(htmlEncode(r)||"?")+"</span>",""!==w&&(o+='<span class="'+cls+'jsdoc-param-defaultValue">='+htmlEncode(w)+"</span>"),v&&(o='<span class="'+cls+'jsdoc-param-optionalWrapper"><span class="'+cls+'farg-optionalBracket">[</span>'+o+'<span class="'+cls+'jsdoc-param-optionalBracket">]</span></span>')}else o+=htmlEncode(r);n>0&&(o=", "+o),k+=o}if(k+=")",g.rettype&&(k+=j?' -> <span class="'+cls+'type">'+htmlEncode(g.rettype)+"</span>":" -> "+htmlEncode(g.rettype)),k='<span class="'+cls+(j?"typeHeader":"typeHeader-simple")+'">'+k+"</span>",j&&(l&&l.description&&(k+='<div class="'+cls+'farg-current-description"><span class="'+cls+'farg-current-name">'+l.name+": </span>"+l.description+"</div>"),m&&m.length>0))for(var n=0;n<m.length;n++){var y=m[n].type?'<span class="'+cls+'type">{'+m[n].type+"} </span>":"";k+='<div class="'+cls+'farg-current-description">'+y+'<span class="'+cls+'farg-current-name">'+i(m[n])+": </span>"+m[n].description+"</div>"}d.appendChild(elFromString(k))}}if(isNaN(parseInt(c))){if(a.doc){var z=function(a,b){if(0===b.length)return a;a=a.replace(/@param/gi,"@param");for(var c=a.substr(0,a.indexOf("@param"));a.indexOf("@param")!==-1;)a=a.substring(a.indexOf("@param")+6);a=a.indexOf("@")!==-1?a.substr(a.indexOf("@")):"";for(var d="",e=0;e<b.length;e++){if(d+="<div>",d+=""===b[e].parentName.trim()?' <span class="'+cls+'jsdoc-tag">@param</span> ':'<span class="'+cls+'jsdoc-tag-param-child">&nbsp;</span> ',d+=""===b[e].type.trim()?"":'<span class="'+cls+'type">{'+b[e].type+"}</span> ",""!==b[e].name.trim()){var f=b[e].name.trim();""!==b[e].parentName.trim()&&(f=b[e].parentName.trim()+"."+f);var g='<span class="'+cls+'jsdoc-param-name">'+f+"</span>";""!==b[e].defaultValue.trim()&&(g+='<span class="'+cls+'jsdoc-param-defaultValue">='+b[e].defaultValue+"</span>"),b[e].optional&&(g='<span class="'+cls+'jsdoc-param-optionalWrapper"><span class="'+cls+'farg-optionalBracket">[</span>'+g+'<span class="'+cls+'jsdoc-param-optionalBracket">]</span></span>'),d+=g}d+=""===b[e].description.trim()?"":' - <span class="'+cls+'jsdoc-param-description">'+b[e].description+"</span>",d+="</div>"}return""!==d&&(a='<span class="'+cls+'jsdoc-param-wrapper">'+d+"</span>"+a),c+a},A=function(a){try{a=" "+a+" ";for(var c,b=/ ?@\w{1,50}\s ?/gi;null!==(c=b.exec(a));)c.index===b.lastIndex&&b.lastIndex++,a=a.replace(c[0],' <span class="'+cls+'jsdoc-tag">'+c[0].trim()+"</span> ")}catch(a){showError(ts,editor,a)}return a.trim()},B=function(a){a=" "+a+" ";try{for(var c,b=/\s{[^}]{1,50}}\s/g;null!==(c=b.exec(a));)c.index===b.lastIndex&&b.lastIndex++,a=a.replace(c[0],' <span class="'+cls+'type">'+c[0].trim()+"</span> ")}catch(a){showError(ts,editor,a)}return a.trim()},C=function(a){try{for(var e,b="HTTP_PROTO_PLACEHOLDER",c="HTTPS_PROTO_PLACEHOLDER",d=/\bhttps?:\/\/[^\s<>"`{}|\^\[\]\\]+/gi;null!==(e=d.exec(a));){e.index===d.lastIndex&&d.lastIndex++;var f=e[0].replace(/https/i,c).replace(/http/i,b),g=e[0].replace(new RegExp("https://","i"),"").replace(new RegExp("http://","i"),"");a=a.replace(e[0],'<a class="'+cls+'tooltip-link" href="'+f+'" target="_blank">'+g+" </a>")}a=a.replace(new RegExp(c,"gi"),"https").replace(new RegExp(b,"gi"),"http")}catch(a){showError(ts,editor,a)}return a};"*"===e.substr(0,1)&&(e=e.substr(1)),e=htmlEncode(e.trim()),e=z(e,f),e=A(e),e=B(e),e=C(e),d.appendChild(elFromString(e))}if(a.url){d.appendChild(document.createTextNode(" "));var D=elt("a",null,"[docs]");D.target="_blank",D.href=a.url,d.appendChild(D)}a.origin&&d.appendChild(elt("div",null,elt("em",null,"source: "+a.origin)))}return d}function parseJsDocParams(a){if(!a)return[];a=a.replace(/@param/gi,"@param");for(var b=[];a.indexOf("@param")!==-1;){a=a.substring(a.indexOf("@param")+6);for(var g,c=a.indexOf("@"),d=c===-1?a:a.substr(0,c),e={name:"",parentName:"",type:"",description:"",optional:!1,defaultValue:""},f=/\s{[^}]{1,50}}\s/;null!==(g=f.exec(d));)g.index===f.lastIndex&&f.lastIndex++,e.type=g[0],d=d.replace(e.type,"").trim(),e.type=e.type.replace("{","").replace("}","").replace(" ","").trim();if(d=d.trim(),"["===d.substr(0,1)){e.optional=!0;var h=d.indexOf("]");if(h===-1){showError("failed to parse parameter name; Found starting '[' but missing closing ']'");continue}var i=d.substring(0,h+1);if(d=d.replace(i,"").trim(),i=i.replace("[","").replace("]",""),i.indexOf("=")!==-1){var j=i.substr(i.indexOf("=")+1);""===j.trim()?e.defaultValue="undefined":e.defaultValue=j.trim(),e.name=i.substring(0,i.indexOf("=")).trim()}else e.name=i.trim()}else{var k=d.indexOf(" ");k!==-1?(e.name=d.substr(0,k),d=d.substr(k).trim()):(e.name=d,d="")}var l=e.name.indexOf(".");l!==-1&&(e.parentName=e.name.substring(0,l),e.name=e.name.substring(l+1)),d=d.trim(),d.length>0&&(e.description=d.replace("-","").trim()),e.name=htmlEncode(e.name),e.parentName=htmlEncode(e.parentName),e.description=htmlEncode(e.description),e.type=htmlEncode(e.type),e.defaultValue=htmlEncode(e.defaultValue),b.push(e)}return b}function findRefs(a,b,c){inJavascriptMode(b)&&a.request(b,{type:"refs",fullDocs:!0},function(d,e){if(d)return showError(a,b,d);if("function"==typeof c)return void c(e);closeAllTips();var f=document.createElement("div"),g=document.createElement("span");g.textContent=e.name+"("+e.type+")",g.setAttribute("style","font-weight:bold;"),f.appendChild(g);var h=makeTooltip(null,null,f,b,!1,-1);if(!e.refs||0===e.refs.length)return void h.appendChild(elt("div","","No References Found"));var i=document.createElement("div");i.setAttribute("style","font-style:italic; margin-bottom:3px; cursor:help"),i.innerHTML=e.refs.length+" References Found",i.setAttribute("title","Use up and down arrow keys to navigate between references. \n\nPress Esc while focused on the list to close the popup (or use the close button in the top right corner).\n\n This is not guaranteed to find references in other files or references for non-private variables."),f.appendChild(i);var j=document.createElement("select");j.setAttribute("multiple","multiple"),j.addEventListener("change",function(){for(var e,c=findDoc(a,b),d=this,f=0;f<d.options.length;f++)e?d[f].selected=!1:d[f].selected&&(e=d[f],e.style.color="grey");var g=e.getAttribute("data-file"),i={line:e.getAttribute("data-line"),ch:e.getAttribute("data-ch")},j=300,k={name:g};c.name==g&&(k=c,j=50);var l=b.getAnimatedScroll();l&&b.setAnimatedScroll(!1),moveTo(a,c,k,i,null,!0),setTimeout(function(){moveTooltip(h,null,null,b),closeAllTips(h),l&&b.setAnimatedScroll(!0)},j)});for(var k=function(a,b){var c=document.createElement("option");c.setAttribute("data-file",a),c.setAttribute("data-line",b.line),c.setAttribute("data-ch",b.ch),c.text=b.line+1+":"+b.ch+" - "+a,j.appendChild(c)},l=function(){var a=15*j.options.length;a=a>175?175:a,j.style.height=a+"px",h.appendChild(j),j.focus(),j.addEventListener("keydown",function(a){a&&a.keyCode&&27==a.keyCode&&remove(h)})},m=0;m<e.refs.length;m++){var n=e.refs[m];try{k(n.file,n.start),m===e.refs.length-1&&l()}catch(a){console.log("findRefs inner loop error (should not happen)",a)}}})}function rename(a,b){findRefs(a,b,function(c){if(!c||0===c.refs.length)return void showError(a,b,"Cannot rename as no references were found for this variable");var d=function(d){a.request(b,{type:"rename",newName:d,fullDocs:!0},function(d,e){return d?showError(a,b,d):void applyChanges(a,e.changes,function(a){var d=makeTooltip(null,null,elt("div","","Replaced "+a.replaced+" references sucessfully"),b,!0),e=elt("div","");e.setAttribute("style","color:red"),a.replaced!=c.refs.length&&(e.textContent=" WARNING! original refs: "+c.refs.length+", replaced refs: "+a.replaced),""!==a.errors&&(e.textContent+=" \n Errors encountered:"+a.errors),""!==e.textContent&&d.appendChild(e)})})},e=makeTooltip(null,null,elt("div","",c.name+": "+c.refs.length+" references found \n (WARNING: this wont work for refs in another file!) \n\n Enter new name:\n"),b,!0),f=elt("input");e.appendChild(f);try{setTimeout(function(){f.focus()},100)}catch(a){}var g=elt("button","");g.textContent="Rename",g.setAttribute("type","button"),g.addEventListener("click",function(){remove(e);var c=f.value;return c&&0!==c.trim().length?void d(c):void showError(a,b,"new name cannot be empty")}),e.appendChild(g)})}function applyChanges(a,b,c){for(var d=ace.require("ace/range").Range,e=Object.create(null),f=0;f<b.length;++f){var g=b[f];(e[g.file]||(e[g.file]=[])).push(g)}var h={replaced:0,status:"",errors:""};for(var i in e){var j=a.docs[i],k=e[i];if(j){k.sort(function(a,b){return cmpPos(b.start,a.start)});for(var f=("*rename"+ ++nextChangeOrig,0);f<k.length;++f)try{var g=k[f];g.start=toAceLoc(g.start),g.end=toAceLoc(g.end),j.doc.session.replace(new d(g.start.row,g.start.column,g.end.row,g.end.column),g.text),h.replaced++}catch(a){h.errors+="\n "+i+" - "+a.toString(),console.log("error applying rename changes",a)}}}"function"==typeof c&&c(h)}function isOnFunctionCall(a){if(!inJavascriptMode(a))return!1;if(somethingIsSelected(a))return!1;if(isInCall(a))return!1;var b=getCurrentToken(a);if(b&&b.start){if(b.type.indexOf("entity.name.function")!==-1)return!1;if(b.type.indexOf("storage.type")!==-1)return!1;var c=a.session.getTokenAt(a.getSelectionRange().end.row,b.start+b.value.length+1);return!(!c||"("!==c.value)}}function somethingIsSelected(a){return""!==a.getSession().getTextRange(a.getSelectionRange())}function getCusorPosForTooltip(a){var b=a.renderer.$cursorLayer.getPixelPosition();return b.top=a.renderer.$cursorLayer.cursors[0].offsetTop,b.top+=a.renderer.scroller.getBoundingClientRect().top,b.left+=a.renderer.container.offsetLeft,{left:b.left+45,top:b.top+17}}function getCurrentToken(a){try{var b=a.getSelectionRange().end;return a.session.getTokenAt(b.row,b.column)}catch(b){showError(ts,a,b)}}function getCallPos(a,b){if(!somethingIsSelected(a)&&inJavascriptMode(a)){var c={},d=b||a.getSelectionRange().start;d=toAceLoc(d);for(var e=d.row,f=d.column,g=Math.max(0,e-6),h="",i=0,j=[],k=e;k>=g;k--){var l=a.session.getLine(k);k===e&&(l=l.substr(0,f));for(var m=l.length;m>=0;m--)if(h=l.substr(m,1),"}"===h||")"===h||"]"===h)i+=1;else if("{"===h||"("===h||"["===h){if(!(i>0)){if("("===h){var n=!1,o=l.substr(0,m);if(!o.length){n&&console.log("not fn call because before parent is empty");break}if(" "===o.substr(o.length-1)){n&&console.log("not fn call because there is a space before paren");break}var p=o.split(" ").reverse()[1];if(p&&"function"===p.toLowerCase()){n&&console.log("not fn call because this is a function declaration");break}var q=a.session.getTokenAt(k,m);if(q&&(q.type.toString().indexOf("comment")!==-1||"keyword"===q.type||"storage.type"===q.type)){n&&console.log("existing because token is comment, keyword, or storage.type (`function`)");break}n&&console.info("getting arg hints!"),c={line:k,ch:m};break}break}i-=1}else","===h&&0===i&&j.push({line:k,ch:m})}if(c.hasOwnProperty("line")){for(var r=0,s=0;s<j.length;s++){var t=j[s];(t.line===c.line&&t.ch>c.ch||t.line>c.line)&&(r+=1)}return{start:toTernLoc(c),argpos:r}}}}function isInCall(a,b){var c=getCallPos(a,b);return!!c}function updateArgHints(a,b){function g(){a.request(b,{type:"type",preferFunction:!0,end:d},function(c,f){return c&&c.toString().toLowerCase().indexOf("no expression at")===-1&&c.toString().toLowerCase().indexOf("no type found at")===-1?showError(a,b,c):void(!c&&f.type&&/^fn\(/.test(f.type)&&(a.cachedArgHints={start:d,type:parseFnType(f.type),name:f.exprName||f.name||"fn",guess:f.guess,doc:b,comments:f.doc},showArgHints(a,b,e)))})}clearTimeout(debounce_updateArgHints),closeArgHints(a);var c=getCallPos(b);if(c){var d=c.start,e=c.argpos,f=a.cachedArgHints;return f&&f.doc==b&&0===cmpPos(d,f.start)?showArgHints(a,b,e):void(debounce_updateArgHints=setTimeout(g,500))}}function showArgHints(a,b,c){closeArgHints(a);var d=a.cachedArgHints;d.type,d.comments;if(!d.hasOwnProperty("params"))if(d.comments){var g=parseJsDocParams(d.comments);g&&0!==g.length?d.params=g:d.params=null}else d.params=null;var h=getCusorPosForTooltip(b),i={name:d.name,guess:d.guess,fnArgs:d.type,doc:d.comments,params:d.params},j=createInfoDataTip(i,!0,c);a.activeArgHints=makeTooltip(h.left,h.top,j,b,!0)}function parseFnType(a){function d(b){for(var d=0,e=c;;){var f=a.charAt(c);if(b.test(f)&&!d)return a.slice(e,c);/[{\[\(]/.test(f)?++d:/[}\]\)]/.test(f)&&--d,++c}}if("fn"!==a.substring(0,2))return null;if(a.indexOf("(")===-1)return null;var b=[],c=3;if(")"!=a.charAt(c))for(;;){var e=a.slice(c).match(/^([^, \(\[\{]+): /);if(e&&(c+=e[0].length,e=e[1]),b.push({name:e,type:d(/[\),]/)}),")"==a.charAt(c))break;c+=2}var f=a.slice(c).match(/^\) -> (.*)$/);return{args:b,rettype:f&&f[1]}}function htmlEncode(a){var b={"<":"&lt;",">":"&gt;"};return String(a).replace(/[<>]/g,function(a){return a?b[a]:""})}function cmpPos(a,b){return a=toTernLoc(a),b=toTernLoc(b),a.line-b.line||a.ch-b.ch}function dialog(a,b,c){alert("need to implment dialog")}function elFromString(a){var b=document.createDocumentFragment(),c=document.createElement("span");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b}function elt(a,b){var c=document.createElement(a);b&&(c.className=b);for(var d=2;d<arguments.length;++d){var e=arguments[d];"string"==typeof e&&(e=document.createTextNode(e)),c.appendChild(e)}return c}function closeAllTips(a){var b=document.querySelectorAll("."+cls+"tooltip");if(b.length>0)for(var c=0;c<b.length;c++)a&&b[c]==a||remove(b[c])}function tempTooltip(a,b,c){c||(c=3e3);var d=getCusorPosForTooltip(a);return makeTooltip(d.left,d.top,b,a,!0,c)}function makeTooltip(a,b,c,d,e,f){if(null===a||null===b){var g=getCusorPosForTooltip(d);a=g.left,b=g.top}var h=elt("div",cls+"tooltip",c);h.style.left=a+"px",h.style.top=b+"px",document.body.appendChild(h);var i=document.createElement("a");if(i.setAttribute("title","close"),i.setAttribute("class",cls+"tooltip-boxclose"),i.addEventListener("click",function(){remove(h)}),h.appendChild(i),e===!0){if(!d)throw Error("tern.makeTooltip called with closeOnCursorActivity=true but editor was not passed. Need to pass editor!");var j=function(){h.parentNode&&(remove(h),d.getSession().selection.off("changeCursor",j),d.getSession().off("changeScrollTop",j),d.getSession().off("changeScrollLeft",j))};d.getSession().selection.on("changeCursor",j),d.getSession().on("changeScrollTop",j),d.getSession().on("changeScrollLeft",j)}if(f&&(f=parseInt(f,10),f>100)){var k=function(){if(h.parentNode){fadeOut(h,f);try{d.getSession().selection.off("changeCursor",j),d.getSession().off("changeScrollTop",j),d.getSession().off("changeScrollLeft",j)}catch(a){}}};setTimeout(k,f)}return h}function moveTooltip(a,b,c,d){if(null===b||null===c){var e=getCusorPosForTooltip(d);b=e.left,c=e.top}a.style.left=b+"px",a.style.top=c+"px"}function remove(a){var b=a&&a.parentNode;b&&b.removeChild(a)}function fadeOut(a,b){return b||(b=1100),b===-1?void remove(a):(a.style.opacity="0",void setTimeout(function(){remove(a)},b))}function showError(a,b,c,d){try{var e="",f="",g=function(a){return a&&a.name&&a.stack&&a.message};if(g(c)?(e=c.name+": "+c.message,f=c.stack):c.msg&&c.err?(e=c.msg,g(c.err)&&(e+=": "+c.err.message,f=c.err.stack)):(e=c,f="details not supplied. current stack:\n"+(new Error).stack),console.log("ternError:\t ",e,"\n details:",f),!d){var h=elt("span",null,e);h.style.color="red",tempTooltip(b,h)}}catch(a){setTimeout(function(){throw void 0===typeof e&&(e=" (no error passed)"),new Error("tern show error failed."+e+"\n\n fail error: "+a.name+"\n"+a.message+"\n"+a.stack)},0)}}function closeArgHints(a){a.activeArgHints&&(remove(a.activeArgHints),a.activeArgHints=null)}function jumpToDef(a,b){function c(c){var d={type:"definition",variable:c||null},e=findDoc(a,b);a.server.request(buildRequest(a,e,d,null,!0),function(c,d){if(c)return showError(a,b,c);if(!d.file&&d.url)return void window.open(d.url);if(d.file){var g,f=a.docs[d.file];return f&&(g=findContext(f.doc,d))?(a.jumpStack.push({file:e.name,start:toTernLoc(b.getSelectionRange().start),end:toTernLoc(b.getSelectionRange().end)}),void moveTo(a,e,f,g.start,g.end)):void moveTo(a,e,{name:d.file},d.start,d.end)}showError(a,b,"Could not find a definition.")})}c()}function moveTo(a,b,c,d,e,f){if(e=e||d,b!=c)return void(a.options.switchToDoc?(f||closeAllTips(),a.options.switchToDoc(c.name,toAceLoc(d),toAceLoc(e))):showError(a,b.doc,"Need to add editor.ternServer.options.switchToDoc to jump to another document"));var g=toAceLoc(d);b.doc.gotoLine(g.row,g.column||0),b.doc.getSession().unfold(g);var h=b.doc.getSession().getSelection();h.setSelectionRange({start:toAceLoc(d),end:toAceLoc(e)})}function jumpBack(a,b){var c=a.jumpStack.pop(),d=c&&a.docs[c.file];d&&moveTo(a,findDoc(a,b),d,c.start,c.end)}function findContext(a,b){try{var c=b.context.slice(0,b.contextOffset).split("\n"),d=b.start.line-(c.length-1),e=null;e=1==c.length?b.start.ch:a.session.getLine(d).length-c[0].length;for(var f=Pos(d,e),g=a.session.getLine(d).slice(f.ch),h=d+1;h<a.session.getLength()&&g.length<b.context.length;++h)g+="\n"+a.session.getLine(h)}catch(a){console.log("ext-tern.js findContext Error; (error is caused by a doc (string) being passed to this function instead of editor due to ghetto hack from adding VS refs... need to fix eventually. should only occur when jumping to def in separate file)",a)}return b}function atInterestingExpression(a){var b=a.getSelectionRange().end,c=a.session.getTokenAt(b.row,b.column);return b=toTernLoc(b),(!(c.start<b.ch)||"comment"!=c.type&&"string"!=c.type)&&/\w/.test(a.session.getLine(b.line).slice(Math.max(b.ch-1,0),b.ch+1))}function sendDoc(a,b){a.server.request({files:[{type:"full",name:b.name,text:docValue(a,b)}]},function(a){a?console.error(a):b.changed=null})}function inJavascriptMode(a){return"javascript"==getCurrentMode(a)}function getCurrentMode(a){var b=a.session.$mode.$id||"";if(b=b.split("/").pop(),"html"===b||"php"===b){"php"===b&&(b="html");var c=a.getCursorPosition(),d=a.session.getState(c.row);"object"==typeof d&&(d=d[0]),d.substring&&("js-"==d.substring(0,3)?b="javascript":"css-"==d.substring(0,4)?b="css":"php-"==d.substring(0,4)&&(b="php"))}return b}function startsWith(a,b){return a.slice(0,b.length).toUpperCase()==b.toUpperCase()}function trackChange(a,b,c){var d={};d.from=toTernLoc(c.data.range.start),d.to=toTernLoc(c.data.range.end),c.data.hasOwnProperty("text")?d.text=[c.data.text]:d.text=c.data.lines;var e=findDoc(a,b),f=a.cachedArgHints;f&&f.doc==b&&cmpPos(f.start,d.to)<=0&&(a.cachedArgHints=null);var g=e.changed;null===g&&(e.changed=g={from:d.from.line,to:d.from.line});var h=d.from.line+(d.text.length-1);d.from.line<g.to&&(g.to=g.to-(d.to.line-h)),h>=g.to&&(g.to=h+1),g.from>d.from.line&&(g.from=g.from.line),b.session.getLength()>bigDoc&&d.to-g.from>100&&setTimeout(function(){e.changed&&e.changed.to-e.changed.from>100&&sendDoc(a,e)},200)}function loadExplicitVsRefs(a,b){if(b.getSession().ternServer&&b.getSession().ternServer.enabledAtCurrentLocation(b)){for(var c=window&&window.location&&0===window.location.toString().toLowerCase().indexOf("http"),d="",e=0;e<b.session.getLength();e++){var f=b.session.getLine(e);if("///"!==f.substr(0,3))break;d+="\n"+f}if(""!==d){for(var h,g=/(?!\/\/\/\s*?<reference path=")[^"]*/g,i=[];null!=(h=g.exec(d));){h.index===g.lastIndex&&g.lastIndex++;var j=h[0].replace('"',"");j.toLowerCase().indexOf("reference path")===-1&&""!==j.trim()&&j.toLowerCase().indexOf("/>")===-1&&j.toLowerCase().indexOf("vsdoc")===-1&&i.push(j)}for(var k=document.createElement("span"),l=0,m=0,n=function(a,c){m++;var d=document.createElement("div");d.setAttribute("style","font-size:smaller; font-style:italic; color:"+(c?"red":"gray")),d.textContent=a,k.appendChild(d),l==m&&tempTooltip(b,k)},o=function(d){try{var e=0===d.toLowerCase().indexOf("http");if(e||c){l++;var f=new XMLHttpRequest;f.open("get",d,!0),f.send(),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?(console.log("adding web reference: "+d),n("adding web reference: "+d),b.getSession().ternServer.addDoc(d,f.responseText)):404==f.status?(console.log("error adding web reference (not found): "+d,f),n("error adding web reference (not found): "+d,!0)):(console.log("error adding web reference (unknown error, see xhr): "+d,f),n("error adding web reference (unknown error, see console): "+d,!0)))}}else l++,resolveFilePath(a,d,function(b){getFile(a,b,function(c,d){c||!d?(console.log("error getting file: "+b,c),n("error getting file: "+b+"(see console for details)",!0)):(a.addDoc(b,d.toString()),console.log("adding reference: "+b),n("adding reference: "+b))})})}catch(a){throw console.log("add to tern error; path="+d),a}},e=0;e<i.length;e++){var p=i[e];o(p)}}}}function WorkerServer(a,b){function g(a,b){b&&(a.id=++e,f[e]=b),c.postMessage(a)}var c=b?new b:new Worker(a.options.workerScript),d=function(a){c.postMessage({type:"init",defs:a.options.defs,plugins:a.options.plugins,scripts:a.options.workerDeps})};d(a);var e=0,f={};c.onmessage=function(b){var c=b.data;"getFile"==c.type?getFile(a,c.name,function(a,b){g({type:"getFile",err:String(a),text:b,id:c.id})}):"debug"==c.type?console.log("(worker debug) ",c.message):c.id&&f[c.id]&&(f[c.id](c.err,c.body),delete f[c.id])},c.onerror=function(a){for(var b in f)f[b](a);f={}},this.addFile=function(a,b){g({type:"add",name:a,text:b})},this.delFile=function(a){g({type:"del",name:a})},this.request=function(a,b){g({type:"req",body:a},b)},this.setDefs=function(a){g({type:"setDefs",defs:a})},this.restart=function(a){d(a)},this.sendDebug=function(a){g({type:"debug",body:a})}}var TernServer=function(options){var self=this;this.options=options||{};var plugins=this.options.plugins||(this.options.plugins={});if(plugins.hasOwnProperty("doc_comment")||(plugins.doc_comment={}),plugins.doc_comment.hasOwnProperty("fullDocs")||(plugins.doc_comment.fullDocs=!0),this.options.hasOwnProperty("switchToDoc")||(this.options.switchToDoc=function(a,b){console.log("tern.switchToDoc called but not defined (need to specify this in options to enable jumpting between documents). name="+a+"; start=",b)}),this.options.hasOwnProperty("defs")||(this.options.defs=["browser","ecma5"]),this.options.hasOwnProperty("useWorker")||(this.options.useWorker=!0),this.options.useWorker)this.server=new WorkerServer(this,this.options.workerClass);else{if(this.options.defs&&this.options.defs.length>0){for(var tmp=[],i=0;i<this.options.defs.length;i++)tmp.push(eval("def_"+this.options.defs[i]));this.options.defs=tmp}this.server=new tern.Server({getFile:function(a,b){return getFile(self,a,b)},async:!0,defs:this.options.defs,plugins:this.options.plugins})}this.docs=Object.create(null),this.trackChange=function(a,b){trackChange(self,b,a)},this.cachedArgHints=null,this.activeArgHints=null,this.jumpStack=[],this.aceTextCompletor=null,this.lastAutoCompleteFireTime=null,this.queryTimeout=3e3,this.options.queryTimeout&&!isNaN(parseInt(this.options.queryTimeout))&&(this.queryTimeout=parseInt(this.options.queryTimeout))},Pos=function(a,b){return{line:a,ch:b}},cls="Ace-Tern-",bigDoc=250,aceCommands={ternJumpToDef:{name:"ternJumpToDef",exec:function(a){a.getSession().ternServer.jumpToDef(a)},bindKey:"Alt-."},ternJumpBack:{name:"ternJumpBack",exec:function(a){a.getSession().ternServer.jumpBack(a)},bindKey:"Alt-,"},ternShowType:{name:"ternShowType",exec:function(a){a.getSession().ternServer.showType(a)},bindKey:"Ctrl-I"},ternFindRefs:{name:"ternFindRefs",exec:function(a){a.getSession().ternServer.findRefs(a)},bindKey:"Ctrl-E"},ternRename:{name:"ternRename",exec:function(a){a.getSession().ternServer.rename(a)},bindKey:"Ctrl-Shift-E"},ternRefresh:{name:"ternRefresh",exec:function(a){var b=!1;null!=a.getSession().ternServer.refreshDocLastCalled&&(new Date).getTime()-a.getSession().ternServer.refreshDocLastCalled<1e3&&(b=!0),a.getSession().ternServer.refreshDocLastCalled=(new Date).getTime(),a.getSession().ternServer.refreshDoc(a,b)},bindKey:"Alt-R"}},debugCompletions=!1;TernServer.prototype={bindAceKeys:function(a){for(var b in aceCommands){var c=aceCommands[b];a.commands.addCommand(c)}},addDoc:function(a,b){var c={doc:b,name:a,changed:null},d="";return"String"===b.constructor.name?d=b:(d=docValue(this,c),b.on("change",this.trackChange)),this.server.addFile(a,d),this.docs[a]=c},delDoc:function(a){var b=this.docs[a];if(b){try{b.doc.off("change",this.trackChange)}catch(a){}delete this.docs[a],this.server.delFile(a)}},hideDoc:function(a){closeAllTips();var b=this.docs[a];b&&b.changed&&sendDoc(this,b)},refreshDoc:function(a,b){var c=function(b){var c=document.createElement("span");c.setAttribute("style","color:green;"),c.innerHTML=b,tempTooltip(a,c,2e3)};if(b)return this.docChanged(a),void c("Tern fully refreshed (reloaded current doc and all refs)");var d=findDoc(this,a);sendDoc(this,d),c('Tern document refreshed <div style="color:gray; font-size:smaller;">(press hotkey twice in  &lt; 1 second to do a full reload including refs)</div>')},getCompletions:function(a,b,c,d,e){getCompletions(this,a,b,c,d,e)},showType:function(a,b,c){showType(this,a,b,c)},updateArgHints:function(a){updateArgHints(this,a)},closeArgHints:function(a){closeArgHints(this,a)},jumpToDef:function(a){jumpToDef(this,a)},jumpBack:function(a){jumpBack(this,a)},rename:function(a){rename(this,a)},findRefs:function(a){findRefs(this,a)},request:function(a,b,c,d,e){var f=this,g=findDoc(this,a),h=buildRequest(this,g,b,d,e);this.server.request(h,function(a,d){!a&&f.options.responseFilter&&(d=f.options.responseFilter(g,b,h,a,d)),c(a,d)})},enabledAtCurrentLocation:function(a){return inJavascriptMode(a)},getCallPos:function(a,b){return getCallPos(a,b)},docChanged:function(a){var b=this;for(var c in this.docs)this.delDoc(c);var d=function(c){b.addDoc(c,a),loadExplicitVsRefs(b,a)};this.options.getCurrentFileName?this.options.getCurrentFileName(d):d("current")},restart:function(){this.options.useWorker&&this.server.restart(this)},debug:function(a){return a?void(this.options.useWorker&&this.server.sendDebug(a)):void console.log("debug commands: files, filecontents")},debugCompletions:function(a){
    debugCompletions=!!a}},exports.TernServer=TernServer;var popupSelectBound=!1,nextChangeOrig=0,debounce_updateArgHints=null,dom=require("ace/lib/dom");dom.importCssString(".Ace-Tern-tooltip { border: 1px solid silver; border-radius: 3px; color: #444; padding: 2px 5px; padding-right:15px; font-size: 12px; font-family: monospace; background-color: white; white-space: pre-wrap; max-width: 50em; max-height:30em; overflow-y:auto; position: absolute; z-index: 10; -webkit-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); -moz-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); transition: opacity 1s; -moz-transition: opacity 1s; -webkit-transition: opacity 1s; -o-transition: opacity 1s; -ms-transition: opacity 1s; } .Ace-Tern-tooltip-boxclose { position:absolute; top:0; right:3px; color:red; } .Ace-Tern-tooltip-boxclose:hover { background-color:yellow; } .Ace-Tern-tooltip-boxclose:before { content:'×'; cursor:pointer; font-weight:bold; font-size:larger; } .Ace-Tern-completion { padding-left: 12px; position: relative; } .Ace-Tern-completion:before { position: absolute; left: 0; bottom: 0; border-radius: 50%; font-weight: bold; height: 13px; width: 13px; font-size:11px; line-height: 14px; text-align: center; color: white; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; } .Ace-Tern-completion-unknown:before { content:'?'; background: #4bb; } .Ace-Tern-completion-object:before { content:'O'; background: #77c; } .Ace-Tern-completion-fn:before { content:'F'; background: #7c7; } .Ace-Tern-completion-array:before { content:'A'; background: #c66; } .Ace-Tern-completion-number:before { content:'1'; background: #999; } .Ace-Tern-completion-string:before { content:'S'; background: #999; } .Ace-Tern-completion-bool:before { content:'B'; background: #999; } .Ace-Tern-completion-guess { color: #999; } .Ace-Tern-hint-doc { max-width: 35em; } .Ace-Tern-fhint-guess { opacity: .7; } .Ace-Tern-fname { color: black; } .Ace-Tern-farg { color: #70a; } .Ace-Tern-farg-current { color: #70a; font-weight:bold; font-size:larger; text-decoration:underline; } .Ace-Tern-farg-current-description { font-style:italic; margin-top:2px; color:black; } .Ace-Tern-farg-current-name { font-weight:bold; } .Ace-Tern-type { color: #07c; font-size:smaller; } .Ace-Tern-jsdoc-tag { color: #B93A38; text-transform: lowercase; font-size:smaller; font-weight:600; } .Ace-Tern-jsdoc-param-wrapper{ /*background-color: #FFFFE3; padding:3px;*/ } .Ace-Tern-jsdoc-tag-param-child{ display:inline-block; width:0px; } .Ace-Tern-jsdoc-param-optionalWrapper { font-style:italic; } .Ace-Tern-jsdoc-param-optionalBracket { color:grey; font-weight:bold; } .Ace-Tern-jsdoc-param-name { color: #70a; font-weight:bold; } .Ace-Tern-jsdoc-param-defaultValue { color:grey; } .Ace-Tern-jsdoc-param-description { color:black; } .Ace-Tern-typeHeader-simple{ font-size:smaller; font-weight:bold; display:block; font-style:italic; margin-bottom:3px; color:grey; } .Ace-Tern-typeHeader{ display:block; font-style:italic; margin-bottom:3px; } .Ace-Tern-tooltip-link{font-size:smaller; color:blue;} .ace_autocomplete {width: 400px !important;}","ace_tern")}),ace.define("ace/tern/tern",["require","exports","module","ace/config","ace/snippets","ace/autocomplete/text_completer","ace/autocomplete","ace/tern/tern_server","ace/editor"],function(a,b,c){"use strict";var d=a("../config"),e=a("../snippets").snippetManager,f={getCompletions:function(a,b,c,d,f){var g=e.snippetMap,h=[];e.getActiveScopes(a).forEach(function(a){for(var b=g[a]||[],c=b.length;c--;){var d=b[c],e=d.name||d.tabTrigger;e&&h.push({caption:e,snippet:d.content,meta:d.tabTrigger&&!d.name?d.tabTrigger+"⇥ ":"snippet"})}},this),f(null,h)}},g=a("../autocomplete/text_completer"),h={getCompletions:function(a,b,c,d,e){var f=a.session.getState(c.row),g=b.$mode.getCompletions(f,b,c,d);e(null,g)}},i=[f,g,h];b.setCompleters=function(a){i=a||[]},b.addCompleter=function(a){i.push(a)};var j={name:"expandSnippet",exec:function(a){var b=e.expandWithTab(a);b||a.execCommand("indent")},bindKey:"tab"},k=function(a){var b=a.$id;if(e.files||(e.files={}),l(b),a.$modes)for(var c in a.$modes)k(a.$modes[c])},l=function(a){if(a&&!e.files[a]){var b=a.replace("mode","snippets");e.files[a]={},d.loadModule(b,function(b){b&&(e.files[a]=b,!b.snippets&&b.snippetText&&(b.snippets=e.parseSnippetFile(b.snippetText)),e.register(b.snippets||[],b.scope),b.includeScopes&&(e.snippetMap[b.scope].includeScopes=b.includeScopes,b.includeScopes.forEach(function(a){l("ace/mode/"+a)})))})}},o=a("../autocomplete").Autocomplete;o.startCommand={name:"startAutocomplete",exec:function(a,b){a.completer||(a.completer=new o),a.completers=[],a.$enableSnippets&&a.completers.push(f),a.getSession().ternServer&&a.$enableTern&&a.getSession().ternServer.enabledAtCurrentLocation(a)?(a.completers.push(a.getSession().ternServer),a.getSession().ternServer.aceTextCompletor=g):a.$enableBasicAutocompletion&&a.completers.push(g,h),a.completer.showPopup(a),a.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var s,v,p=function(a,b){k(b.session.$mode)},q={},r=a("./tern_server").TernServer,t=function(a){function f(){q.workerScript||(q.workerScript=b),s=new r(q),a()}var b=q.workerScript||d.moduleUrl("worker/tern");if(q.useWorker===!1){var c="ace_tern_files";if(document.getElementById(c))f();else{var e=document.createElement("script");e.setAttribute("id",c),document.head.appendChild(e),e.onload=f,e.setAttribute("src",b)}}else f()},u=null,w=function(a,b){clearTimeout(v),v=setTimeout(function(){u.getSession().ternServer.updateArgHints(u)},10)},x=function(a,b){if("insertstring"===a.command.name&&("."===a.args||/^[a-zA-Z_0-9\$]$/.test(a.args))&&a.editor.getSession().ternServer&&a.editor.getSession().ternServer.enabledAtCurrentLocation(a.editor)){var c=a.editor.getSelectionRange().end,d=a.editor.session.getTokenAt(c.row,c.column);if(d&&"string"!==d.type&&d.type.toString().indexOf("comment")===-1){try{a.editor.getSession().ternServer.lastAutoCompleteFireTime=null}catch(a){}a.editor.execCommand("startAutocomplete")}}};i.push(s),b.server=s;var y=a("../editor").Editor;d.defineOptions(y.prototype,"editor",{enableTern:{set:function(a){var b=this;"object"==typeof a&&(q=a,a=!0),a?(u=b,t(function(){b.completers=i,b.getSession().ternServer=s,b.commands.addCommand(o.startCommand),b.getSession().selection.on("changeCursor",w),b.commands.on("afterExec",x),s.bindAceKeys(b),q.startedCb&&q.startedCb()})):(delete b.getSession().ternServer,b.getSession().selection.off("changeCursor",w),b.commands.off("afterExec",x),b.enableBasicAutocompletion||b.commands.removeCommand(o.startCommand))},value:!1},enableBasicAutocompletion:{set:function(a){a?(this.completers=i,this.commands.addCommand(o.startCommand)):this.$enableTern||this.commands.removeCommand(o.startCommand)},value:!1},enableSnippets:{set:function(a){a?(this.commands.addCommand(j),this.on("changeMode",p),p(null,this)):(this.commands.removeCommand(j),this.off("changeMode",p))},value:!1}})}),function(){ace.require(["ace/tern/tern"],function(){})}();